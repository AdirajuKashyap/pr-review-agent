<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PR Review Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
        .additions { color: green; font-weight: bold; }
        .deletions { color: red; font-weight: bold; }
        .score-bar { height: 25px; font-weight: bold; }
    </style>
</head>
<body>
<div class="container my-5">
    <h1 class="mb-4">PR Review — {{ pr_data.repo_name }} #{{ pr_data.pr_number }}</h1>
    <h4>{{ pr_data.title }}</h4>

    <div class="my-3">
        <strong>Score:</strong> {{ analysis.final_score }} / 100
        <div class="progress mt-2">
            <div class="progress-bar" role="progressbar" style="width: {{ analysis.final_score }}%;" aria-valuenow="{{ analysis.final_score }}" aria-valuemin="0" aria-valuemax="100">
                {{ analysis.final_score }}%
            </div>
        </div>
    </div>

    <div class="mt-4">
        <h3>File Analysis:</h3>
        {% for file in analysis.files %}
        <div class="card mb-3">
            <div class="card-header">
                <strong>{{ file.filename }}</strong>
                &nbsp; — <span class="additions">+{{ file.additions }}</span> / <span class="deletions">-{{ file.deletions }}</span>
            </div>
            <div class="card-body">
                {% if file.issues %}
                    <ul>
                        {% for issue in file.issues %}
                        <li>{{ issue.type }} — {{ issue.detail }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No issues found.</p>
                {% endif %}
                <button class="btn btn-sm btn-outline-primary mt-2" type="button" data-bs-toggle="collapse" data-bs-target="#patch{{ loop.index }}" aria-expanded="false" aria-controls="patch{{ loop.index }}">
                    Show Patch
                </button>
                <div class="collapse mt-2" id="patch{{ loop.index }}">
                    <pre>{{ file.patch }}</pre>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <a href="/" class="btn btn-secondary mt-3">Analyze another PR</a>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
